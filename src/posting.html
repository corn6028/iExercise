
<!DOCTYPE html>
<html>
<head>
 <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <!--<meta http-equiv="Content-Type" c> -->

  <!-- Site Properities -->
  <title>iExercise 一起運動吧！</title>

  <link rel="stylesheet" type="text/css" href="../dist/semantic.css">
  <link rel="stylesheet" type="text/css" href="myprofile.css">
  <link rel="stylesheet" type="text/css" href="katy.css">
  <link rel="stylesheet" type="text/css" href="posting.css">
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/themes/hot-sneaks/jquery-ui.css" rel="stylesheet">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
 <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.js"></script>-->
  <script src="../dist/semantic.js"></script>
  <script src="https://www.parsecdn.com/js/parse-1.3.3.min.js"></script>
  <script src="katy.js"></script>
<!--  <script src="myprofile.js"></script>-->
  <script src="posting.js"></script>

  <link rel="icon" type="image/jpg" href="../images/icon.jpg" size="16x16" /> 
 
  <script type='text/javascript'>
        /*$(document).ready(function() {
            $('#post_img').uploadPreview({ width: 290, height: 200, imgDiv: "#imgDiv"});
        });
        //說明：圖片上傳預覽插件
        //上傳的時候可以生成固定寬高範圍內的等比例縮放圖
       
        //參數設置：
        //width                     存放圖片固定大小容器的寬
        //height                    存放圖片固定大小容器的高
        //imgDiv                    頁面DIV的JQuery的id
        //maxSize     圖片大小最大限制(K)
        //imgType                   數組後綴名
        //**********************圖片上傳預覽插件*************************
        (function($) {
            jQuery.fn.extend({
                uploadPreview: function(opts) {
                    opts = jQuery.extend({
                        width: 0,
                        height: 0,
                        imgDiv: $(opts.imgDiv),
                        maxSize:1500,
                        imgType: ["gif", "jpeg", "jpg", "bmp", "png"],
                        callback: function() { return false; }
                    }, opts || {});
                    //var _self = this;
                    var _this = $(this);
                    var imgDiv = $(opts.imgDiv);
                    imgDiv.width(opts.width);
                    imgDiv.height(opts.height);
                    
                    var version = parseInt($.browser.version,10);
                   
                    autoScaling = function() {
                     
                        if (version == 7 || version == 8  || version == 9) imgDiv.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod = "image";
                        var img_width = imgDiv.width();
                        var img_height = imgDiv.height();
                        if (img_width > 0 && img_height > 0) {
                            var rate = (opts.width / img_width < opts.height / img_height) ? opts.width / img_width : opts.height / img_height;
                            if (rate <= 1) {
                                if (version == 7 || version == 8  || version == 9) imgDiv.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod = "scale";
                                imgDiv.width(img_width * rate);
                                imgDiv.height(img_height * rate);
                            } else {
                                imgDiv.width(img_width);
                                imgDiv.height(img_height);
                            }
                            var left = (opts.width - imgDiv.width()) * 0.5;
                            var top = (opts.height - imgDiv.height()) * 0.5;
                            imgDiv.css({ "margin-left": left});
                            imgDiv.show();
							$("#upload_image").hide();
                        }
                    },
                   
                    createImg = function(){
                  imgDiv.html('');
                  
                        var img = $("<img />");
                        imgDiv.replaceWith(img);
                        imgDiv = img;
                    },
          
                    _this.change(function() {
                     
                        if (this.value) {
                            if (!RegExp("\.(" + opts.imgType.join("|") + ")$", "i").test(this.value.toLowerCase())) {
                                alert("圖片類型必須是" + opts.imgType.join("，") + "中的一種");
                                this.value = "";
                                return false;
                            }
                            imgDiv.hide();
                            if ($.browser.msie && version < 10) {
                             
                                if (version == 6) {
                                 
                                    var image = new Image();
                                    image.onload = function(){
                                        if( (image.fileSize/1024) > opts.maxSize) {
                                         alert('圖片大小不能超過'+opts.maxSize+'K');
                                         return false;
                                        }
                                    }
                                    image.src = 'file:///' + this.value;
       
                                    createImg();
                                    imgDiv.attr('src', image.src);
                                    autoScaling();
                                }  else {
                                 
                                 //this.select();
                                 //var img = document.selection.createRange().text;/
                                    var image = new Image();
                                    image.onload = function(){
                                        if( (image.fileSize/1024) > opts.maxSize) {
                                         alert('圖片大小不能超過'+opts.maxSize+'K');
                                         return false;
                                        }
                                    }
                                    image.src = this.value;                         
                                   
                                 imgDiv.html('');                         
                                    imgDiv.css({ filter: "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)" });
                                    imgDiv.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod = "image";                          
                                   
                                    try {
                                        imgDiv.get(0).filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = this.value;
                                    } catch (e) {
                                        alert("無效的圖片文件！");
                                        return;
                                    }                           
                                   
                                    setTimeout("autoScaling()", 100);                           
                                }
                            }
                            else {
                             try{  
                              var file = null;
                              var size = 0;
                              if(this.files && this.files[0] ){
                               file = this.files[0];
                               size = file.size;
                              }else if(this.files && this.files.item(0)) {                       
                               file = this.files.item(0);  
                               size = file.fileSize;
                                 }
        
                              if((size/1024) > opts.maxSize){
                               alert('圖片大小不能超過'+opts.maxSize+'K');
                                     return false;
                           }
                           
                           createImg();
                              
                              //Firefox 因安全性問題已無法直接通過input[file].value 獲取完整的文件路徑
                              try{
                               //Firefox7.0 以下                       
                               imgDiv.attr('src', file.getAsDataURL());
                              }catch(e){
                               //Firefox8.0以上                       
                               imgDiv.attr('src', window.URL.createObjectURL(file));
                              }
                              
                                 imgDiv.css({ "vertical-align": "middle" });
                                 setTimeout("autoScaling()", 100);
                             }catch(e){                      
                              //支持html5的瀏覽器,比如高版本的firefox、chrome、ie10
                              if (this.files && this.files[0]) {                      
                               if((this.files[0].size/1024) > opts.maxSize){
                                         alert('圖片大小不能超過'+opts.maxSize+'K');
                                         return false;
                               }
                               
                                     var reader = new FileReader();
                                     reader.onload = function (e) {                                
                                      imgDiv.attr('src', e.target.result); 
                                     };
                                     reader.readAsDataURL(this.files[0]);
                                     setTimeout("autoScaling()", 100);
                                 } 
                             };
                            }
                        }
                    });
                }
            });
        })(jQuery);   */
    </script>

</head>
<body >  
<div class="ui inverted orange vertical segment" style="position:fixed; top:0px; left:0px; right:0px; z-index:500">
  <div class="ui grid">
  <div class="equal height row">
    <div class="one wide column">
      <div class="center aligned column">
    	<img class="logo image" src="../images/logo.png" id="i-exercise" style="top:0px;width:70%">
      <!--  <h2 color="white" style=margin:0px id="i-exercise"> iExercise</h2>-->
      </div>
    </div>
    <div class="four wide column">
      <div class="center aligned column">
        <div class="ui fluid icon input">
          <input type="text" placeholder="Search...">
          <i class="orange search icon"></i>
        </div>
      </div>
    </div>
    <div class="two wide column">
      <div class="center aligned column">
        <img class="ui avatar image" src="../images/face.jpg" id="me">
        <a id="my_name" style="text-align:center;color:white;font-size:14pt"></a>
        <div class="circular ui green icon button">
          <i class="sign out icon"></i>
          Log out</div>
      </div>     
    </div>
  </div>
  </div>
</div>
	
	<div id="left" style="position:fixed;">
    <div class="row" style="padding:15px">
      <a style="text-align:center;color:#E63F00;font-size:22pt" id="user_name"></a>
    </div>
      <div class='circle'>
        <div class='inner'id="inner"></div>
      </div>
		<div class="ui items"> 
			<div class="item" id="friend-post">
				<div class="middle aligned content">
					<a class="header" style=font-size:1.5em>	
					<i class="users icon "></i>
					朋友動態</a>
				</div>
			</div>
			<div class="item" id="winner-post">
				<div class="middle aligned content">
					<a class="header" style=font-size:1.5em>	
					<i class="users icon "></i>
					成功者動態</a>
				</div>
			</div>
		</div>
		</div>

		<div id="right">
  <!-- <div class="twelve wide column" style="background:#FAF0E6"> -->
  <div class="row" style="padding:1.3%">
      <form class="ui form segment"  onsubmit="return validate_form(this)" method="post" style="margin:0">
        <div class="ui two column middle aligned stackable divided grid">
          <div class="column">
            <div class="ui horizontal segment">
            <textarea placeholder="想說些什麼呢？" id="post"></textarea>
            </div>
          </div>
          <div class="column" style="padding-top:40px">
            <div class="ui horizontal segment">
            <div class="field">
              <div class="ui left icon input">
              <input name="weight" type="text" placeholder="Enter weight.." onkeyup="if(isNaN(value))execCommand('undo')"onafterpaste="if(isNaN(value))execCommand('undo')" id="pweight">
              <i class="dashboard icon"></i>
              </div>
            </div>
            <br/>
            <div class="field">
              <div class="ui left icon input">
              <input name="distance" type="text" placeholder="Enter km.." onkeyup="if(isNaN(value))execCommand('undo')"onafterpaste="if(isNaN(value))execCommand('undo')" id="pdis">
              <i class="checkered flag icon"></i>
              </div>
            </div>
            <br/><br/>
            <button type="submit" class="ui inverted blue button" style="float:right;" id="submit">Submit</button>
            </div>
          </div>
        </div>
      </form>
    </div>

      <div class="ui two column grid" id="post_board">
<!--        <div class="row">
          <div class="column">
            <div class="ui Compact segment" >
              <div class="ui two column grid">
              <div class="four wide column" >
                <div class='scircle'>
                  <div class='inner'></div>
                </div>
                </div>
              <div class="twelve wide column" >
              <div class="row">
                <div class="ui two column grid">
                <div class="seven wide column" style="padding:0px">
                <a class="user" style="font-size:16pt;vertical-align: top;">Elliot Fu</a>
                <div class="date" style="font-size:8pt;vertical-align: top;color:#666666;">2小時前</div>
                </div>
                <div class="nine wide column" style="padding:0px;">
                  <div class="ui column grid">
                  <div class="five wide column" style="padding:8px;padding-left:0px;padding-right:0px">
                    <p style="font-size:16pt;color:#227700;text-align:center" >5.3</p>
                  </div>
                  <div class="five wide column" style="padding:8px;padding-left:0px;padding-right:0px">
                    <p style="font-size:16pt;color:#227700;">Km，</p>
                  </div>
                  <div class="three wide column" style="padding:8px;padding-left:0px;padding-right:0px">
                    <p style="font-size:16pt;color:#227700;" >45</p>
                  </div>
                  <div class="three wide column" style="padding:8px;padding-left:0px;padding-right:0px">
                    <p style="font-size:16pt;color:#227700;">Kg</p>
                  </div>
                </div>
                </div>
  
              </div>
              </div>
              <div class="row" style="margin-top:15px">
                <p style="font-size:14pt;">今天也運動了</p>
                
              </div>
                <div class="row" style="margin-top:15px">
                  
                <div class="meta" style="float:right;font-size:14px">
                <a class="like">
                <i class="large like icon"></i> 4 Likes
                </a>
                </div>
                <div class="meta" style="float:center">
                    <a class="comment" id="comment">
                      <i class="large comment outline icon" ></i>Comments
                    </a>
                  </div>
               </div>
              </div>
            </div>
            </div>
          </div>  
        </div>-->

        <div class="ui small modal" id="commentmodal" >
                    
     	<div class="ui small modal" id="likemodal">       
   

      
    </div>
    
  </div>

<script>
$(document).ready(function(){ 
	var Post = Parse.Object.extend("p");
	var post_friend = new Parse.Query(Post);
	post_friend.descending("createdAt");
	post_friend.find({
  		success: function(results) {
    		if(results.length == 0){
				alert("你還沒有朋友喔哭哭");
			}
			function float2int (value) {
    			return value | 0;
			}
			// Do something with the returned Parse.Object values
    		for (var i = 0; i < results.length; i++) { 
      			var object = results[i];
				var now = new Date();
				var time_new = now.getTime();
				var time_old = object.createdAt.getTime();
				var t = time_new-time_old;
				if(t>60000){
					if(t>3600000){
						if(t>86400000){
							if(t>604800000){
								var time_z = new Date(time_old);
							}else{
								t = float2int(t/86400000);
								var time_z = t + " days ago";
								if(t==1){	var time_z ="1 day ago";}
							}			
						}else{
							t = float2int(t/3600000);
							var time_z = t + " hours ago";
							if(t==1){	var time_z ="1 hour ago";}
						}
					}else{
						t = float2int(t/60000);
						var time_z = t + " minutes ago";
						if(t==1){	var time_z ="1 minute ago";}
					}
				}else{
					time_z = "1 minute ago";
				}
				if(i%2==0){	var pos = '<div class="column">';}
				else{	var pos = '<div class="eight wide column"></div><div class="eight wide column">';}
				var post_pic = object.get("my_pic");
				var post_name = object.get("last_name");
				var post_content = object.get("post");
				var likers = object.get("like_list");
				var post_list = '<div class="row">'+pos+
            					'<div class="ui Compact segment" >'+
              					'<div class="ui two column grid">'+
              					'<div class="four wide column" >'+
                				"<div class='scircle'>"+
                  				"<div class='inner' style='background-image:url("+object.get('my_pic')+");'></div></div></div>"+
              					'<div class="twelve wide column" >'+
              					'<div class="row">'+
                				'<div class="ui two column grid">'+
                				'<div class="seven wide column" style="padding:0px">'+
								'<div class="ui items"><div class="item"><div class="content">'+
                				'<a class="header" style="font-size:15pt;vertical-align: top;">'+object.get('last_name')+'</a>'+
                				'<div class="meta" style="font-size:8pt;vertical-align: top;color:#666666;">'+time_z+'</div></div></div></div></div>'+
                				'<div class="nine wide column" style="padding:0px;">'+
                  				'<div class="ui column grid">'+
                  				'<div class="five wide column" style="padding:8px;padding-left:0px;padding-right:0px">'+
                    			'<p style="font-size:16pt;color:#227700;text-align:center" >'+object.get('pdis')+'</p></div>'+
                  				'<div class="five wide column" style="padding:8px;padding-left:0px;padding-right:0px">'+
                    			'<p style="font-size:16pt;color:#227700;">Km，</p></div>'+
                  				'<div class="three wide column" style="padding:8px;padding-left:0px;padding-right:0px">'+
                    			'<p style="font-size:16pt;color:#227700;" >'+object.get('pweight')+'</p></div>'+
                  				'<div class="three wide column" style="padding:8px;padding-left:0px;padding-right:0px">'+
                    			'<p style="font-size:16pt;color:#227700;">Kg</p></div></div></div></div></div>'+
              					'<div class="row" style="margin-top:15px">'+
                				'<p style="font-size:14pt;">'+object.get('post')+'</p></div>'+
                				'<div class="row" style="margin-top:15px">'+ 
                				'<div class="meta" style="float:right;font-size:14px">'+
								'<i class="large like icon" style="color:red" onclick="likes(\''+object.id+'\')"></i>'+
                				'<a class="like" id="'+object.id+'" onclick="like_list(\''+object.id+'\',\''+likers+'\')">'+object.get("like")+ ' Likes'+'</a></div>'+
                				'<div class="meta" style="float:center">'+
                    			'<a class="comment" id="comment" onclick="comments(\''+object.id+'\',\''+post_pic+'\',\''+post_name+'\',\''+escape(post_content)+'\',\''+time_z+'\')">'+
                      			'<i class="large comment outline icon" ></i>'+object.get("comment")+'  Comments'+'</a></div></div></div></div></div></div></div>';

				document.getElementById('post_board').innerHTML = document.getElementById('post_board').innerHTML + post_list;
		
    		}
  		},
  		error: function(error) {
    		alert("Error: " + error.code + " " + error.message);
  		}
	});
});

function likes(initValue){
	var friend = [currentUser.get("username")];
	var P = Parse.Object.extend("p");
	var p = new Parse.Query(P);
	p.get(initValue, {
  		success: function(result) {
    		// The object was retrieved successfully.
			var found = $.inArray(currentUser.get("username"), result.get("like_list"))>-1;
			if(found){	alert("你按過讚摟～");}
			else{
				friend = friend.concat(result.get("like_list"));
				result.set("like",result.get("like")+1);
				result.set("like_list",friend);
				result.save();
				document.getElementById(initValue).innerHTML = result.get("like").toString()+" Likes";}
				//$('#like').html(result.get("like").toString()+" Likess");}
  		},
  		error: function(object, error) {
    		// The object was not retrieved successfully.
    		// error is a Parse.Error with an error code and message.
 	 	}
	});
}

function like_list(initValue,likers){
	$("#likmodal").children("div").remove();
	var friend = likers.split(",");
	//alert(Array.isArray(friend));
	var query = new Parse.Query("User");
	query.containedIn("username",friend);
	query.find({
		success: function(results) {
			alert(results.length);
			$('#likemodal').innerHTML = '<div class="ui six doubling cards">';
    		// Do something with the returned Parse.Object values
    		for (var i = 0; i < results.length; i++) { 
      			var object = results[i];
				var like_list = [];
				like_list.push(	'<div class="card">',
    						'<div class="image">',
      						'<img src="../images/face.jpg" style="width:50px;height"50px;"></div>',
    						'<div class="content">',
      						'<a class="header">Elliot Fu</a></div></div>');
				$('#likemodal').append(like_list.join(''));
    		}
			$('#likemodal').innerHTML += "</div>";
			$('#likemodal').modal('show');
  		},
  		error: function(error) {
    		alert("Error: " + error.code + " " + error.message);
  		}
	});
}

function comments(initValue,post_pic,post_name,post_content,post_time){
	$('#commentmodal').children("div").remove();

	//console.log(unescape(post_content));
	var Comment = Parse.Object.extend("comments");
	var comment_mine = new Parse.Query(Comment);
	comment_mine.equalTo("postid", initValue);
	comment_mine.ascending("createdAt");
	comment_mine.find({
  		success: function(results) {
    		if(results.length == 0){
				//alert(initValue);
				function float2int (value) {
    				return value | 0;
				}
				var no_comment ="<div class='ui segment' style='padding:10%'>"+
    						"<div class='row' style='padding:0;'>"+
            				"<div class='ui column grid'>"+
            				"<div class='four wide column'>"+
               				"<div class='label'>"+
                  			"<div class='scircle'>"+
                   			"<div class='inner' style='background-image:url("+post_pic+");'></div></div></div></div>"+
              				"<div class='twelve wide column' style='padding-left:0'>"+
               				"<a style='font-size:25px'>"+post_name+"</a>"+
							"<div class='date'>"+post_time+"</div>"+
               				"<h3>"+unescape(post_content)+"</h3></div></div></div>"+     
           					"<div class='ui center aligned grid'>"+
                	//		"<img src='"+posted.get('my_pic')+"' style='width:70%;height:70%'></img></div>"+
            				"<div class='ui gray stacked segment' style='background:#FFEFD5'>"+
              				"<h4 style='margin-top:0;'>Comment</h4>"+
             				"<div class='ui divider'></div>"+
							"<div class='ui column grid'>"+
							'<div class="equal height row" style="padding:0">'+
              				'<div class="two wide column" style="padding-right:0;padding-top:0">'+
                			'<img class="ui avatar image" src="'+currentUser.get('my_pic')+'"></img></div>'+
             				'<div class="fourteen wide column" style="padding-left:5px">'+
              				'<div class="ui fluid icon input">'+
                			'<input id="input1" type="text" placeholder="Comment.." onkeydown="if (event.keyCode == 13) write_comment(\''+initValue+'\')">'+
                			'<i class="write icon"></i></div></div>'+
							'<div class="ui divider"></div></div></div></div></div></div></div>';
  				//document.getElementById('commentmodal').innerHTML = document.getElementById('commentmodal').innerHTML + no_comment;
				$('#commentmodal').append(no_comment);
				$('#commentmodal').modal('show');
				//$('#commentmodal').children("div").remove();
				//var init = '<div class="ui small modal" id="commentmodal" >';
				//document.getElementById('commentmodal').innerHTML = init;
			}else{
			// Do something with the returned Parse.Object values
			var no_comment = [];
			no_comment.push("<div class='ui segment' style='padding:10%'>",
    						"<div class='row' style='padding:0;'>",
            				"<div class='ui column grid'>",
            				"<div class='four wide column'>",
               				"<div class='label'>",
                  			"<div class='scircle'>",
                   			"<div class='inner' style='background-image:url("+post_pic+");'></div></div></div></div>",
              				"<div class='twelve wide column' style='padding-left:0'>",
               				"<a style='font-size:25px'>"+post_name+"</a>",
							"<div class='date'>"+post_time+"</div>",
               				"<h3>"+unescape(post_content)+"</h3></div></div></div>",  
           					"<div class='ui center aligned grid'>",
            				"<div class='ui gray stacked segment' style='background:#FFEFD5' id='comments_list'>",
              				"<h4 style='margin-top:0;'>Comment</h4>",
             				"<div class='ui divider'></div>");
			//alert("1");
			$('#commentmodal').append(no_comment.join(''));
	
    		for (var i = 0; i < results.length; i++) { 
      			var object = results[i];
				var now = new Date();
				var time_new = now.getTime();
				var time_old = object.createdAt.getTime();
				var t = time_new-time_old;
				if(t>60000){
					if(t>3600000){
						if(t>86400000){
							if(t>604800000){
								var time_z = new Date(time_old);
							}else{
								t = float2int(t/86400000);
								var time_z = t + " days ago";
								if(t==1){	var time_z ="1 day ago";}
							}			
						}else{
							t = float2int(t/3600000);
							var time_z = t + " hours ago";
							if(t==1){	var time_z ="1 hour ago";}
						}
					}else{
						t = float2int(t/60000);
						var time_z = t + " minutes ago";
						if(t==1){	var time_z ="1 minute ago";}
					}
				}else{
					time_z = "1 minute ago";
				}

				var comment_list = [];
				comment_list.push(  "<div class='ui column grid'>",
                					"<div class='equal height row' style='padding:0'>",
              						"<div class='two wide column' style='padding-right:0;padding-top:0'>",
                					"<img class='ui avatar image' src='"+object.get('my_pic')+"'></img></div>",
              						'<div class="four wide column" style="padding-left:5px">',
                					'<a style="font-size:18px">'+object.get('last_name')+'</a>',
                					'<div class="date" style="font-size:12px">'+time_z+'</div></div>',
              						'<div class="ten wide column" style="padding-left:0;">',
                  					'<p style="font-size:16px">'+object.get('comment')+'</p></div></div>',
              						'<div class="ui divider"></div>');
				//alert("2");
				$('#comments_list').append(comment_list.join(''));

              //	document.getElementById('commentmodal').innerHTML = document.getElementById('commentmodal').innerHTML + comment_list; 
 			}
			var end_list = [];
			end_list.push(  "<div class='ui column grid'>",
							'<div class="equal height row" style="padding:0">',
              				'<div class="two wide column" style="padding-right:0;padding-top:0">',
                			'<img class="ui avatar image" src="'+currentUser.get('my_pic')+'"></img></div>',
			//				'<div class="four wide column" style="padding-left:5px">'+
              //  			'<a style="font-size:18px">'+currentUser.get('last_name')+'</a></div>'+
             				'<div class="ten wide column" style="padding-left:5px">',
              				'<div class="ui fluid icon input">',
                			'<input id="input1" type="text" placeholder="Comment.." onkeydown="if (event.keyCode == 13) write_comment(\''+initValue+'\')">',
                			'<i class="write icon"></i></div></div>',
							'<div class="ui divider"></div></div></div></div></div></div></div></div>');
		//	alert(initValue);
			$('#comments_list').append(end_list.join(''));
			//document.getElementById('commentmodal').innerHTML = document.getElementById('comment_modal').innerHTML + end_list;
			$("#commentmodal").modal('show');
			}
  		},
  		error: function(error) {
    		alert("Error: " + error.code + " " + error.message);
  		}
	});

//	if(event.keyCode == 13){
//		alert($('#commentmodal').is(visible));
//	}
}

function write_comment(post_id){
	if($('input1').val()==""){
		//alert("Please comment!");
	}else{
		var C = Parse.Object.extend("comments");
		var c = new C();
		c.set("postid",post_id);
		c.set("comment",$("#input1").val());
		c.set("username",currentUser.get("username"));
		c.set("last_name",currentUser.get("last_name"));
		c.set("my_pic",currentUser.get("my_pic"));
		//alert($("#input1").val());
		
		c.save().then(function(response) {
        	alert("success");
        	location.reload(); //refreshes the form
   		 }, function(error) {
        	alert("error");
        	location.reload();
    	});
		$("#commentmodal").modal('hide');
	}
}

</script>

</body>
</html>
